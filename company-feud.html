<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Company Feud - Participant</title>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&family=Roboto:wght@400;700&display=swap" rel="stylesheet">

<!-- Shared CSS -->
<link rel="stylesheet" href="gameshow.css">
</head>
<body>

<header>
  <button class="back-btn" onclick="window.location.href='index.html'" title="Back">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="3.5" stroke-linecap="round" stroke-linejoin="round">
      <path d="M15 18l-6-6 6-6"/>
      <path d="M9 12h12"/>
    </svg>
  </button>
  💬 Company Feud
</header>

<div class="container">
  <div><strong>Question:</strong> <span id="questionNum">1</span></div>

  <!-- UPDATED: Select team row -->
  <div class="team-select-row">
    <label for="teamSelect">Select Your Team:</label>
    <select id="teamSelect">
      <option value="Team 1">Team 1</option>
      <option value="Team 2">Team 2</option>
      <option value="Team 3">Team 3</option>
      <option value="Team 4">Team 4</option>
      <option value="Team 5">Team 5</option>
    </select>
  </div>

  <h3>Your Guess</h3>
  <div class="form-row">
    <input type="text" id="guessInput" placeholder="Type your answer here">
    <button onclick="submitGuess()">🚀 Submit Guess</button>
  </div>

  <div class="status" id="statusMessage">Waiting for your submission...</div>
</div>

<div class="container">
  <h3>📊 Company Feud Scores</h3>
  <table id="miniScoreTable">
    <thead>
      <tr>
        <th>Team</th>
        <th>Points</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCqHMhVHAeOn3A8MMcvjVT_6h14jbZhzW0",
  authDomain: "apacgameshow-f8d5d.firebaseapp.com",
  databaseURL: "https://apacgameshow-f8d5d-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "apacgameshow-f8d5d",
  storageBucket: "apacgameshow-f8d5d.firebasestorage.app",
  messagingSenderId: "572761881903",
  appId: "1:572761881903:web:3caef7b2e394a9d430f5da"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

let selectedTeam = document.getElementById("teamSelect").value;
document.getElementById("teamSelect").addEventListener("change", () => {
    selectedTeam = document.getElementById("teamSelect").value;
});

// Update question number
db.ref("companyFeud/currentQuestion").on("value", snap => {
    document.getElementById("questionNum").innerText = snap.val() || 1;
});

// Submit guess
function submitGuess() {
    const guess = document.getElementById("guessInput").value.trim();
    if (!guess) {
        alert("❌ Please enter a guess first.");
        return;
    }
    const timestamp = Date.now();
    const guessData = { guess: guess, timestamp: timestamp };
    const teamRef = db.ref(`companyFeud/answers/${selectedTeam}`);
    teamRef.once("value").then(snap => {
        let guesses = snap.val() || [];
        if (!Array.isArray(guesses)) guesses = [];
        guesses.push(guessData);
        teamRef.set(guesses).then(() => {
            document.getElementById("statusMessage").innerText = `✅ Submitted: ${guess}`;
            document.getElementById("guessInput").value = "";
        });
    });
}

// Mini-game scoreboard
db.ref("companyFeud/roundScores").on("value", snap => {
    const scores = snap.val() || {};
    const sorted = Object.entries(scores).sort((a,b) => b[1] - a[1]);
    const tbody = document.querySelector("#miniScoreTable tbody");
    tbody.innerHTML = "";
    sorted.forEach(([team, score]) => {
        const row = `<tr><td>${team}</td><td>${score}</td></tr>`;
        tbody.innerHTML += row;
    });
});
</script>

</body>
</html>